
<h1>Projeto 02 - Blog Pessoal - CRUD 01</h1>

O que veremos por aqui:

1. Apresentação do Projeto 
2. Criar o Projeto no Spring Initializr
2. Conhecer o arquivo pom.xml
3. Configurar o Banco de dados da aplicação
   
<h2>1. O Projeto Blog Pessoal</h2>

O Projeto Blog Pessoal será o nosso Projeto Guia no aprendizado do Framework Spring e suas principais funcionalidades. Todo o código que implementarmos no projeto Blog Pessoal servirá de base para a construção do Projeto Integrador, que sempre receberá novas funcionalidades depois que você adquirir os conhecimentos necessários através do Blog Pessoal.Veja o Diagrama de Classes do Projeto Blog Pessoal na figura abaixo:

<div align="center"><img src="https://i.imgur.com/G71SCJ0.png" title="source: imgur.com" /></div>

<br />

O Projeto será composto por 3 Recursos (Conjunto de Classes e Interfaces responsáveis por mapear um tipo de Objeto e persistir no Banco de dados Relacional) e uma Classe auxiliar:

| Classe           | Descrição                                                    |
| ---------------- | ------------------------------------------------------------ |
| **Postagem**     | Recurso responsável por definir  Objeto Postagem (posts) do Blog Pessoal |
| **Tema**         | Recurso responsável por classificar as postagens através do Objeto Tema |
| **Usuario**      | Recurso responsável por definir o Objeto Usuário, que poderá acessar e criar postagens no Blog Pessoal |
| **UsuarioLogin** | Classe auxiliar, que será utilizada para efetuar login no Blog Pessoal |

Os Recursos irão gerar tabelas no Banco de dados da aplicação. A Classe auxiliar não irá gerar uma tabela no Banco de dados da aplicação, ela servirá de Classe auxiliar na implementação da Segurança da aplicação. Os recursos serão implementados na mesma sequência da tabela acima.

Antes de começar a criar as nossas Classes, vamos criar o nosso Projeto Spring Boot no gerador de templates Spring Initializr e configurar o Banco de dados da aplicação.

 <h2>👣 Passo 01 - Abrindo o Spring Initializr</h2>

1. Abra o Navegador de sua preferência e acesse o **Spring Initializr**, através do endereço: **https://start.spring.io**

<div align="center"><img src="https://i.imgur.com/5V7ZgLm.png?1" title="source: imgur.com" /></div>

<h2>👣 Passo 02 - Setup do Projeto</h2>

<h3>2.1 Configurações iniciais</h3>

Vamos configurar o template inicial do nosso projeto conforme a figura abaixo:

<div align="center"><img src="https://i.imgur.com/EI2RIsx.png?1" title="source: imgur.com" width="85%"/></div>

| <img width=150px/>Item             | Descrição                                                    |
| ---------------- | ------------------------------------------------------------ |
| **Project**      | Define o Gerenciador de Dependências do Projeto (Maven Project). |
| **Language**     | Define a Linguagem (Java).                                   |
| **Spring Boot**  | Define a versão do Spring Boot, que será utilizada. Mantenha a versão indicada pelo Spring Initializr. |
| **Group**        | O Endereço reverso do Domínio da sua Organização. **Exemplo:** *generation.com* 🡪 ***com.generation*** |
| **Artifact**     | O artefato a ser gerado, ou seja, o nome da aplicação que será criada (Mesmo nome do projeto). |
| **Name**         | Nome do Projeto (escrito em letras minúsculas, sem acentos ou espaços). |
| **Description**  | Breve descrição do projeto.                                  |
| **Package Name** | Estrutura do pacote inicial da aplicação (Group + Artifact). **Exemplo:** ***<u>com.generation.blogpessoal</u>*** |
| **Packaging**    | Define como a aplicação será empacotada (JAR).               |
| **Java Version** | Versão do Java (a versão da imagem pode ser diferente da sua tela). |

<br />

**2.2 Dependências**

No projeto Blog Pessoal vamos inserir 5 dependências: **Spring Web, Spring Boot Dev Tools, Spring Data JPA, MySQL Driver e Validation**. 

1. Na página inicial do **Spring Initializr**, clique no botão **ADD DEPENDENCIES... CTRL + B**

2.  Na caixa de pesquisa (indicada na figura abaixo com uma seta amarela), digite o nome da dependência que você deseja adicionar e clique sobre o nome da Dependência para adicionar (indicada na figura com um retângulo vermelho)

   <div align="center"><img src="https://i.imgur.com/E4t8IJp.png?1" title="source: imgur.com" width="95%"/></div>

3. Repita os itens 1 e 2 para adicionar as demais Dependências.

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="200px"/> | <div align="left"> **DICA:** *Mantenha a tecla **CTRL** pressionada ao clicar sobre a Dependência que será adicionada ao projeto. Desta forma, a janela se manterá aberta e você conseguirá selecionar todas Dependências do projeto de uma só vez.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

4. Após adicionar as cinco Dependências, o item Dependencies do Spring Intializr estará igual a figura abaixo:

<div align="center"><img src="https://i.imgur.com/hGLKE8c.png?1" title="source: imgur.com" width="90%"/></div>

| <img width=250px/>Dependência               | Descrição                                                    |
| ------------------------- | ------------------------------------------------------------ |
| **Spring Web**            | Fornece todas as Bibliotecas necessárias para trabalhar com o protocolo HTTP. |
| **Spring Boot Dev Tools** | Permite a atualização do projeto em tempo real durante o processo de Desenvolvimento da aplicação. |
| **Validation**            | Fornece um conjunto de anotações que permite validar os atributos das Classes da Camada Model. |
| **Spring Data JPA**       | Java Persistence API é uma biblioteca que armazena e recupera objetos que são armazenados em bancos de dados. |
| **MySQL Driver**          | Responsável pela conexão entre nossa aplicação e o Banco de Dados MySQL. Se trocarmos de SGBD precisaremos trocar o Driver da nossa aplicação. |

5. O seu projeto deverá estar semelhante a figura abaixo:

   <div align="center"><img src="https://i.imgur.com/MzhVsRN.png?1" title="source: imgur.com" /></div>

6. Clique em **Generate Ctrl + <img src="https://i.imgur.com/RYKWqGR.png" title="source: imgur.com" width="20px"/>** (CTRL + Enter)

7. Faça o Download do Projeto

<h2>👣 Passo 03 - Importando o Projeto no STS</h2>

1. Extraia o arquivo zip dentro da pasta **Workspace do STS**

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="120px"/> | <div align="left"> **ATENÇÃO:** *A pasta Workspace do STS geralmente está localizada em: C:\Users\seu usuario\Documents\workspace-spring-tool-suite-4-4.12.1.RELEASE, onde 4-4.12.1.RELEASE é a versão do STS* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br /><br />

2. Abra o STS

  <div align="center"><img src="https://i.imgur.com/6WxS1Qx.png" title="source: imgur.com" /></div>

3. Importe o projeto no STS através da opção **File 🡪 Import**

  <div align="center"><img src="https://i.imgur.com/B4ErmiQ.png?1" title="source: imgur.com" /></div> 

<br />

4. Na janela **Import**, clique na pasta **Maven**, na opção **Existing Maven Projects**

<div align="center"><img src="https://i.imgur.com/dRf4Bm2.png" title="source: imgur.com" /></div>

5. No item **Root Directory**, clique no botão **Browse** e selecione a pasta do projeto (indicado em azul na imagem abaixo).
6. No item **Projects**, selecione o arquivo **pom.xml** e clique no botão **Finish** para concluir a importação

 <div align="center"><img src="https://i.imgur.com/GOslEht.png" title="source: imgur.com"/></div>

7. A estrutura do nosso projeto importado para o STS ﬁcará de acordo com a imagem abaixo:

 <div align="center"><img src="https://i.imgur.com/Qje8oUK.png" title="source: imgur.com" /></div>

<h2>👣 Passo 04 - O arquivo pom.xml</h2>

O POM (**Project Object Model**  - "projeto modelo do objeto"), é um arquivo **XML** (eXtensible Markup Language), que dentro do contexto de um projeto Maven, é o arquivo mais importante do projeto. O POM guarda todas as informações básicas de um projeto Maven, bem como as  diretivas de como o artefato (resultado) final deste projeto deve ser construído. 

Dentro do POM colocamos as informações das Bibliotecas (Dependências), que o nosso projeto necessita para funcionar e o Maven se encarrega de efetuar o download e inserir no **Build Path** (Caminho para as Bibliotecas utilizadas pelo compilador Java para construir o projeto final) e **Classpath** (Caminho para os pacotes utilizados no projeto durante o desenvolvimento das Classes, ou seja, as instruções Import).

O Maven irá buscar por essas Dependências em locais chamados **Repositórios**. Existem basicamente dois repositórios, o repositório local que está localizado na pasta **.m2/repository** e o repositório remoto **Maven Repository**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATENÇÃO:** *A pasta .m2 geralmente está localizada no seu computador em: C:\Users\seu usuario\\.m2\repository* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Ao adicionar uma nova dependência no projeto, o Maven primeiro realiza a busca em nosso repositório local, caso não encontre irá buscar no repositório remoto e então fazer o download da biblioteca e disponibiliza-la no repositório local. Dessa forma, caso você necessite utilizar a mesma biblioteca em outro projeto não será necessário realizar o download novamente.

<h3>4.1. Estrutura básica do arquivo pom.xml</h3>

Vamos analisar o arquivo pom.xml gerado em nosso Projeto Blog Pessoal:

 <div align="left"><img src="https://i.imgur.com/zfrQfU2.png" title="source: imgur.com" /></div>

A primeira parte informa a versão do XML e a versão do POM (4.0)

 <div align="left"><img src="https://i.imgur.com/ReKH5K7.png" title="source: imgur.com" /></div>

A segunda parte informa que o Spring Boot será o Projeto Pai (parent) do Projeto Blog Pessoal (child). Esta relação é semelhante ao conceito de Herança da Programação Orientada à Objetos (POO), onde o projeto Spring Blog Pessoal herdará todas as características de um Projeto Spring Boot. A versão do Spring Boot poderá ser diferente.

 <div align="left"><img src="https://i.imgur.com/CghF3yY.png" title="source: imgur.com" /></div>

A terceira parte informa os dados que identificam o projeto (groupid, artifactId e version), que foram informados no Spring Initializr durante a construção do projeto.

 <div align="left"><img src="https://i.imgur.com/Oi408Xp.png" title="source: imgur.com" /></div>

A quarta parte informa a versão do Java. Neste item é possível configurar outras propriedades além da versão.

 <div align="left"><img src="https://i.imgur.com/MzTzLQc.png" title="source: imgur.com" /></div>

A quinta parte informa lista todas as Dependências que o projeto. A lista de Dependências foi criada no Spring Initializr durante a construção do projeto. Durante a implementação do projeto iremos inserir outras Dependências nesta parte de código. 

 <div align="left"><img src="https://i.imgur.com/Gjkjqwa.png" title="source: imgur.com" /></div>

Na sexta e ultima parte temos as informações de build que dizem como o projeto deve  ser compilado pelo Maven. Nessa parte também estão definidos quais plugins do Maven o nosso projeto necessita para ser compilado. 

<br />

<div align="left"><img src="https://i.imgur.com/S4GYUIM.png" title="source: imgur.com" width="25px"/> <a href="https://maven.apache.org/pom.html" target="_blank"><b>Documentação: <i>pom.xml</i></b></a>

<h2>👣 Passo 05 - Configurar a Conexão com o Banco de dados</h2>

Diferente do Projeto Hello World, no Projeto Blog Pessoal vamos utilizar um Banco de dados para persistir os nossos Objetos, ou seja, gravar dados nas Tabelas. 

Antes de iniciarmos o processo de Desenvolvimento do código das nossa Classes, precisamos configurar o o acesso ao nosso Banco de dados, caso contrário ao executar o projeto receberemos a mensagem de erro abaixo no Console, informando que o não foi configurado o acesso ao Banco de dados:

<div align="center"><img src="https://i.imgur.com/bRG9ZSh.png" title="source: imgur.com" /></div>

A configuração do Banco de dados será implementada no arquivo **application.properties**, localizado na Source Folder **src/main/resources**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/eiWrTsD.png" title="source: imgur.com" /></div>

Os **Arquivos de Propriedades** (properties) são usados para manter diversas propriedades do projeto em um único arquivo para executar o aplicativo em um ambiente diferente. Neste arquivo você pode configurar além do Banco de dados o Spring Mail para enviar e-mails pela aplicação, Configurações do Servidor, entre outras.

<div align="left"><img src="https://i.imgur.com/mw7d1xn.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html" target="_blank"><b>Documentação: application.properties</b></a>

<br /><br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Atenção aos Detalhes ao inserir as configurações do Banco de dados no arquivo application.properties, especialmente na linha 3, que possui muitas variações entre letras minúsculas e maiúsculas.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />
   
Para configurar o nosso Banco de dados MySQL, vamos Inserir as linhas abaixo no arquivo **application.properties**.

<div align="center"><img src="https://i.imgur.com/BlTE4LE.png" title="source: imgur.com" /></div>

<br /><br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/conteudoGeneration/backend_blog_pessoal/blob/01-blog_pessoal_crud_01/blogpessoal/src/main/resources/application.properties" target="_blank"><b>Código fonte do arquivo application.properties</b></a>

<br /><br />

| Item                                        | Descrição                                                    |
| ------------------------------------------- | ------------------------------------------------------------ |
| **spring.jpa.hibernate.ddl-auto**           | Define como o JPA irá inicializar o Banco de dados. <br />**update** ⇨ O modelo de objeto criado com base nas Anotações na Classe Model é comparado com o esquema existente, e então o Hibernate atualiza o esquema de acordo com as diferenças. Ele nunca exclui as tabelas ou colunas, mesmo que não sejam mais utilizadas. Nesta opção os dados persistidos não são apagados. |
| **spring.jpa.database**                     | Define o SGBD que será utilizado (MySQL)                     |
| **spring.datasource.url**                   | Define os dados da conexão com o Banco de dados: <br /><br />**jdbc:mysql://localhost/db_blogpessoal** ⇨ **endereço** (jdbc:mysql://localhost/) + **nome do Banco** (db_blogpessoal) <br /><br />**?createDatabaseIfNotExist=true** ⇨ criar automaticamente o Banco de dados no MySQL caso ele não exista (true) <br /><br />**&serverTimezone=America/Sao_Paulo** ⇨ define o fuso horario do servidor MySQL (America/Sao_Paulo) <br /><br />**&useSSl=false** ⇨ desabilita a camada de segurança da conexão com o MySQL (SSL) |
| **spring.datasource.username**              | Define o usuário do MySQL (root)                             |
| **spring.datasource.password**              | Define a senha do usuário do MySQL (root)                    |
| **spring.jpa.show-sql**                     | Exibe todas as Queries SQL no Console do STS durante a execução da aplicação |
| **spring.jpa.properties.hibernate.dialect** | Configura a versão do MySQL, em nosso projeto estamos utilizando a versão 8 (**org.hibernate.dialect.MySQL8Dialect**). |
| **spring.jackson.date-format**              | Configura o formato da Data (**yyyy-MM-dd**) e da Hora (**HH:mm:ss**) da aplicação |
| **spring.jackson.time-zone**                | Configura o fuso horario do servidor da aplicação (**Brazil/East**) |

<h2>Observações importantes:</h2>

- O Nome do banco de dados deve seguir o padrão **db_nome-do-banco**. O prefixo **db** indica que se trata de um Database (Banco de dados). O nome do banco é recomendado que seja **o mesmo do projeto** (blogpessoal), em **letras minúsculas**, **sem espaços em branco ou caracteres especiais e acentos**. Para separar as palavras em um nome composto, utilize o _ (underline). **Exemplo:** db_blog_pessoal.

- O endereço **localhost** é o endereço local, ou seja, o seu próprio computador. Quando a aplicação estiver na nuvem, o endereço do Banco de dados será alterado para um endereço remoto.

- Para fins de aprendizagem, estamos utilizando no SGBD MySQL o usuário **root**. Vale ressaltar que no mercado de trabalho, uma aplicação em produção, jamais utilizará o usuário root, por se tratar do usuário administrador do SGBD, que tem plenos poderes sobre o Servidor. Em geral, o DBA (Database Administrator), cria um usuário apenas com os direitos de acesso que a aplicação irá precisar.

- Durante o Desenvolvimento da aplicação, você pode manter a opção: **spring.jpa.show-sql** habilitada (true). Em produção ela deve ser desabilitada.

- A configuração do **fuso-horário** no **Servidor de Banco de dados** e no **Servidor da aplicação** são itens essenciais para evitar que data e hora incorretas sejam persistidas no Banco de dados, especialmente em atributos do tipo Timestamp, que obtém a data e a hora do Servidor.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="110px"/> | <div align="left"> **ATENÇÃO:** *Caso a senha do seu MySQL não seja **root**, atualize a linha: **spring.datasource.password** inserindo a senha que você cadastrou no MySQL no momento da instalação.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="80px"/> | <div align="left"> **DICA:** *Caso você tenha esquecido a senha do seu usuário root do MySQL, consulte o <b>Guia de desinstalação do MySQL</b> e siga as instruções.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/conteudoGeneration/backend_blog_pessoal/tree/01-blog_pessoal_crud_01" target="_blank"><b>Código fonte do projeto</b></a>

<br /><br />

<h2>Anexo I - Modos de inicialização do Banco de dados</h2>

| Forma               | Descrição                                                    |
| ----------------------- | ------------------------------------------------------------ |
| **update**              | O modelo de objeto criado com base nos mapeamentos (Anotações na Classe Model), é comparado com o esquema existente, e então o Hibernate atualiza o esquema de acordo com as diferenças. Ele nunca exclui as tabelas ou colunas existentes, mesmo que não sejam mais exigidas pelo aplicativo. Nesta opção os dados persistidos não são apagados. |
| **create**              | O Hibernate primeiro elimina todas as tabelas existentes no Banco de dados e então cria novas tabelas. Com esta opção todos os seus dados serão perdidos a cada inicialização do projeto. |
| **create-drop**         | Semelhante ao create, com a adição de que o Hibernate irá descartar o banco de dados depois que todas as operações forem concluídas. Esta opção é normalmente utilizada para testes de unidade. |
| **validate**            | Verifica apenas se a estrutura do Banco de dados corresponde às entidades definidas na **Classe Model**. Se o esquema não corresponder, a inicialização do aplicativo lançará um erro (Exception). |
| **none**                | Desativa a inicialização do Banco de dados.                  |

<br />

<h3>Hibernate</h3>

O **Hibernate** é um framework para o mapeamento objeto-relacional escrito na linguagem Java, cujo objetivo é diminuir a complexidade entre os programas Java, baseado no modelo orientado a objeto, que precisam trabalhar com um banco de dados do modelo relacional (presente na maioria dos SGBDs). Em especial, no desenvolvimento de consultas e atualizações dos dados.

<div align="left"><img src="https://i.imgur.com/B0Bni5D.png" title="source: imgur.com" width="25px"/> <a href="https://hibernate.org/" target="_blank"><b>Site Oficial: Hibernate</b></a>
<br />
